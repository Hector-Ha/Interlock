generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  passwordHash String
  firstName String
  lastName  String
  address   String   // JSON string
  identityDocumentId String?
  dateOfBirth String?
  country    String  @default("US")
  
  banks     Bank[]
  transfers Transfer[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Bank {
  id              Int      @id @default(autoincrement())
  userId          Int
  user            User     @relation(fields: [userId], references: [id])
  institutionId   String
  institutionName String
  accessToken     String   // Encrypted later
  itemId          String
  type            String   // checking, savings
  mask            String   // last 4 digits
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([userId, institutionId])
}

model Transfer {
  id              Int      @id @default(autoincrement())
  userId          Int
  user            User     @relation(fields: [userId], references: [id])
  amount          Decimal
  sourceId        String   // Plaid Account ID
  destinationId   String   // Dwolla destination
  status          String   // PENDING, COMPLETED, FAILED
  dwollaTransferId String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
